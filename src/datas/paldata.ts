import { fixedPaluBreed } from "./fixedPalBreed";

export const paldata = [
  {
    id: "001",
    power: 1470,
    male_prob: 0.5,
  },
  {
    id: "002",
    power: 1460,
    male_prob: 0.5,
  },
  {
    id: "003",
    power: 1500,
    male_prob: 0.5,
  },
  {
    id: "004",
    power: 1430,
    male_prob: 0.5,
  },
  {
    id: "005",
    power: 1400,
    male_prob: 0.5,
  },
  {
    id: "006",
    power: 1330,
    male_prob: 0.5,
  },
  {
    id: "007",
    power: 1410,
    male_prob: 0.5,
  },
  {
    id: "008",
    power: 1250,
    male_prob: 0.5,
  },
  {
    id: "009",
    power: 1155,
    male_prob: 0.5,
  },
  {
    id: "010",
    power: 1350,
    male_prob: 0.5,
  },
  {
    id: "011",
    power: 520,
    male_prob: 0.5,
  },
  {
    id: "012",
    power: 1370,
    male_prob: 0.5,
  },
  {
    id: "012B",
    power: 1360,
    male_prob: 0.5,
  },
  {
    id: "013",
    power: 1240,
    male_prob: 0.5,
  },
  {
    id: "013B",
    cn_name: null,
    power: 1240,
    male_prob: 0.5,
  },
  {
    id: "014",
    power: 1450,
    male_prob: 0.5,
  },
  {
    id: "015",
    power: 1390,
    male_prob: 0.5,
  },
  {
    id: "016",
    power: 1490,
    male_prob: 0.5,
  },
  {
    id: "017",
    power: 1380,
    male_prob: 0.5,
  },
  {
    id: "018",
    power: 1455,
    male_prob: 0.5,
  },
  {
    id: "019",
    power: 1230,
    male_prob: 0.5,
  },
  {
    id: "020",
    power: 1130,
    male_prob: 0.5,
  },
  {
    id: "021",
    power: 1180,
    male_prob: 0.5,
  },
  {
    id: "022",
    power: 1220,
    male_prob: 0.5,
  },
  {
    id: "023",
    power: 1290,
    male_prob: 0.5,
  },
  {
    id: "024",
    power: 1480,
    male_prob: 0.5,
  },
  {
    id: "024B",
    power: 1440,
    male_prob: 0.5,
  },
  {
    id: "025",
    power: 870,
    male_prob: 0.5,
  },
  {
    id: "026",
    power: 1060,
    male_prob: 0.5,
  },
  {
    id: "027",
    power: 1340,
    male_prob: 0.5,
  },
  {
    id: "028",
    power: 1280,
    male_prob: 0.5,
  },
  {
    id: "029",
    power: 910,
    male_prob: "20",
  },
  {
    id: "030",
    power: 1320,
    male_prob: 0.5,
  },
  {
    id: "031",
    power: 1090,
    male_prob: 0.5,
  },
  {
    id: "031B",
    power: 1100,
    male_prob: 0.5,
  },
  {
    id: "032",
    power: 1420,
    male_prob: 0.5,
  },
  {
    id: "032B",
    power: 1422,
    male_prob: 0.5,
  },
  {
    id: "033",
    power: 430,
    male_prob: 0.5,
  },
  {
    id: "033B",
    power: 390,
    male_prob: 0.5,
  },
  {
    id: "034",
    power: 1190,
    male_prob: 0.5,
  },
  {
    id: "035",
    power: 930,
    male_prob: 0.5,
  },
  {
    id: "036",
    power: 890,
    male_prob: 0.5,
  },
  {
    id: "037",
    power: 920,
    male_prob: 0.5,
  },
  {
    id: "037B",
    power: 900,
    male_prob: 0.5,
  },
  {
    id: "038",
    power: 420,
    male_prob: 0.5,
  },
  {
    id: "039",
    power: 1310,
    male_prob: 0.5,
  },
  {
    id: "040",
    power: 590,
    male_prob: 0.5,
  },
  {
    id: "040B",
    power: 580,
    male_prob: 0.5,
  },
  {
    id: "041",
    power: 490,
    male_prob: 0.5,
  },
  {
    id: "042",
    power: 790,
    male_prob: 0.5,
  },
  {
    id: "043",
    power: 895,
    male_prob: 0.5,
  },
  {
    id: "044",
    power: 1080,
    male_prob: 0.5,
  },
  {
    id: "045",
    power: 1120,
    male_prob: 0.5,
  },
  {
    id: "045B",
    power: 1140,
    male_prob: 0.5,
  },
  {
    id: "046",
    power: 950,
    male_prob: 0.5,
  },
  {
    id: "047",
    power: 1030,
    male_prob: 0.5,
  },
  {
    id: "048",
    power: 1020,
    male_prob: 0.5,
  },
  {
    id: "048B",
    power: 1000,
    male_prob: 0.5,
  },
  {
    id: "049",
    power: 1040,
    male_prob: 0.5,
  },
  {
    id: "050",
    power: 1070,
    male_prob: "10",
  },
  {
    id: "051",
    power: 330,
    male_prob: "10",
  },
  {
    id: "052",
    power: 510,
    male_prob: 0.5,
  },
  {
    id: "053",
    power: 1300,
    male_prob: 0.5,
  },
  {
    id: "054",
    power: 410,
    male_prob: 0.5,
  },
  {
    id: "055",
    power: 800,
    male_prob: 0.5,
  },
  {
    id: "056",
    power: 680,
    male_prob: 0.5,
  },
  {
    id: "057",
    power: 760,
    male_prob: 0.5,
  },
  {
    id: "058",
    power: 360,
    male_prob: 0.5,
  },
  {
    id: "058B",
    power: 240,
    male_prob: 0.5,
  },
  {
    id: "059",
    power: 880,
    male_prob: 0.5,
  },
  {
    id: "060",
    power: 740,
    male_prob: 0.5,
  },
  {
    id: "061",
    power: 830,
    male_prob: 0.5,
  },
  {
    id: "062",
    power: 1210,
    male_prob: "20",
  },
  {
    id: "063",
    power: 1110,
    male_prob: 0.5,
  },
  {
    id: "064",
    power: 820,
    male_prob: 0.5,
  },
  {
    id: "064B",
    power: 810,
    male_prob: 0.5,
  },
  {
    id: "065",
    power: 560,
    male_prob: 0.5,
  },
  {
    id: "065B",
    cn_name: null,
    power: 550,
    male_prob: 0.5,
  },
  {
    id: "066",
    power: 1150,
    male_prob: 0.5,
  },
  {
    id: "067",
    power: 850,
    male_prob: 0.5,
  },
  {
    id: "068",
    power: 750,
    male_prob: 0.5,
  },
  {
    id: "069",
    power: 940,
    male_prob: "30",
  },
  {
    id: "070",
    power: 1405,
    male_prob: 0.5,
  },
  {
    id: "071",
    power: 660,
    male_prob: 0.5,
  },
  {
    id: "071B",
    power: 620,
    male_prob: 0.5,
  },
  {
    id: "072",
    power: 640,
    male_prob: 0.5,
  },
  {
    id: "073",
    power: 220,
    male_prob: 0.5,
  },
  {
    id: "074",
    power: 380,
    male_prob: 0.5,
  },
  {
    id: "075",
    power: 700,
    male_prob: 0.5,
  },
  {
    id: "076",
    power: 1160,
    male_prob: 0.5,
  },
  {
    id: "077",
    power: 990,
    male_prob: 0.5,
  },
  {
    id: "078",
    power: 1050,
    male_prob: 0.5,
  },
  {
    id: "079",
    power: 450,
    male_prob: 0.5,
  },
  {
    id: "080",
    power: 540,
    male_prob: 0.5,
  },
  {
    id: "080B",
    power: 530,
    male_prob: 0.5,
  },
  {
    id: "081",
    power: 1260,
    male_prob: 0.5,
  },
  {
    id: "081B",
    cn_name: null,
    power: 1270,
    male_prob: 0.5,
  },
  {
    id: "082",
    power: 500,
    male_prob: 0.5,
  },
  {
    id: "083",
    power: 130,
    male_prob: 0.5,
  },
  {
    id: "084",
    power: 710,
    male_prob: 0.5,
  },
  {
    id: "084B",
    power: 670,
    male_prob: 0.5,
  },
  {
    id: "085",
    power: 280,
    male_prob: 0.5,
  },
  {
    id: "085B",
    power: 270,
    male_prob: 0.5,
  },
  {
    id: "086",
    power: 860,
    male_prob: 0.5,
  },
  {
    id: "086B",
    power: 840,
    male_prob: 0.5,
  },
  {
    id: "087",
    power: 780,
    male_prob: 0.5,
  },
  {
    id: "088",
    power: 320,
    male_prob: 0.5,
  },
  {
    id: "088B",
    power: 230,
    male_prob: 0.5,
  },
  {
    id: "089",
    power: 470,
    male_prob: "90",
  },
  {
    id: "089B",
    power: 440,
    male_prob: "90",
  },
  {
    id: "090",
    power: 300,
    male_prob: 0.5,
  },
  {
    id: "090B",
    power: 290,
    male_prob: 0.5,
  },
  {
    id: "091",
    power: 460,
    male_prob: 0.5,
  },
  {
    id: "091B",
    power: 480,
    male_prob: 0.5,
  },
  {
    id: "092",
    power: 340,
    male_prob: "85",
  },
  {
    id: "093",
    power: 980,
    male_prob: 0.5,
  },
  {
    id: "094",
    power: 1010,
    male_prob: 0.5,
  },
  {
    id: "095",
    power: 350,
    male_prob: 0.5,
  },
  {
    id: "096",
    power: 10,
    male_prob: 0.5,
  },
  {
    id: "097",
    power: 190,
    male_prob: 0.5,
  },
  {
    id: "098",
    power: 150,
    male_prob: 0.5,
  },
  {
    id: "099",
    power: 260,
    male_prob: 0.5,
  },
  {
    id: "100",
    power: 570,
    male_prob: 0.5,
  },
  {
    id: "101",
    power: 310,
    male_prob: 0.5,
  },
  {
    id: "101B",
    power: 315,
    male_prob: 0.5,
  },
  {
    id: "102",
    power: 50,
    male_prob: 0.5,
  },
  {
    id: "102B",
    power: 30,
    male_prob: 0.5,
  },
  {
    id: "103",
    power: 200,
    male_prob: 0.5,
  },
  {
    id: "104",
    power: 250,
    male_prob: "30",
  },
  {
    id: "104B",
    power: 210,
    male_prob: "30",
  },
  {
    id: "105",
    power: 370,
    male_prob: 0.5,
  },
  {
    id: "106",
    power: 140,
    male_prob: 0.5,
  },
  {
    id: "107",
    power: 60,
    male_prob: 0.5,
  },
  {
    id: "108",
    power: 80,
    male_prob: 0.5,
  },
  {
    id: "109",
    power: 70,
    male_prob: 0.5,
  },
  {
    id: "110",
    power: 120,
    male_prob: 0.5,
  },
  {
    id: "110B",
    power: 100,
    male_prob: 0.5,
  },
  {
    id: "111",
    power: 90,
    male_prob: 0.5,
  },
] as const;
export type PaluIds = (typeof paldata)[number]["id"];

export const paldataMap = new Map(paldata.map((p) => [p.id, p]));
export const powerToPaluIdMap = new Map<number, PaluIds>();
const paldataByPower = [...paldata].sort((a, b) => a.power - b.power);
for (let i = 0; i < 9999; i++) {
  const power = i;
  // find pal close to power under section
  for (let palIndex = 0; palIndex < paldataByPower.length; palIndex++) {
    const pal = paldataByPower[palIndex];
    if (pal.power > power) {
      const minPalu = paldataByPower[palIndex - 1] || paldata[0];
      const maxPalu = pal;
      const minDiff = power - minPalu.power;
      const maxDiff = maxPalu.power - power;
      const which = minDiff < maxDiff ? minPalu : maxPalu;
      powerToPaluIdMap.set(power, which.id);
    }
  }
}
// all possible combinations of pal
const palCombination: [PaluIds, PaluIds][] = [];
for (let i = 0; i < paldata.length; i++) {
  for (let j = i + 1; j < paldata.length; j++) {
    palCombination.push([paldata[i].id, paldata[j].id]);
  }
}
// find all possible child and mix into a group
const breedRecipes: [PaluIds, PaluIds, PaluIds][] = [];
for (const [parent1, parent2] of palCombination) {
  const child = getChild(parent1, parent2);
  breedRecipes.push([parent1, parent2, child]);
}
// FOR: Parent1+Parent2 = Child
export const palRecipesMap = new Map<string, PaluIds>();
export function formatPaluParentKey(parent1: PaluIds, parent2: PaluIds) {
  return [parent1, parent2].sort().join("-");
}
export function decodePaluParentKey(key: string) {
  return key.split("-") as [PaluIds, PaluIds];
}
for (const [parent1, parent2, child] of fixedPaluBreed) {
  const key = formatPaluParentKey(parent1, parent2);
  palRecipesMap.set(key, child);
}
for (const [parent1, parent2, child] of breedRecipes) {
  const key = formatPaluParentKey(parent1, parent2);
  if (!palRecipesMap.has(key)) {
    palRecipesMap.set(key, child);
  }
}
// FOR: Child = [Parent1, Parent2][]
export const palChildFindMap = new Map<PaluIds, [PaluIds, PaluIds][]>();
palRecipesMap.forEach((child, key) => {
  const [parent1, parent2] = decodePaluParentKey(key);
  const childFind = palChildFindMap.get(child) || [];
  childFind.push([parent1, parent2]);
  palChildFindMap.set(child, childFind);
});
// FOR: Parent1 = [Parent1, Parent2, Child][]
export const oneParentFindRecipes = new Map<
  PaluIds,
  [PaluIds, PaluIds, PaluIds][]
>();
palRecipesMap.forEach((child, key) => {
  const [parent1, parent2] = decodePaluParentKey(key);
  const parentFind = oneParentFindRecipes.get(parent1) || [];
  parentFind.push([parent1, parent2, child]);
  oneParentFindRecipes.set(parent1, parentFind);
});

// build breeding graph
function getChild(parent1: PaluIds, parent2: PaluIds) {
  // (parent1 power + parent2 power + 1) / 2
  return powerToPaluIdMap.get(
    Math.floor(
      (paldataMap.get(parent1)!.power + paldataMap.get(parent2)!.power + 1) / 2,
    ),
  )!;
}
